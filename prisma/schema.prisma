generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Base User model
model User {
  id          String  @id @default(uuid())
  email       String  @unique
  password    String
  name        String
  role        Role
  phoneNumber String?

  // Relations based on type
  admin     Admin?
  assistant Assistant?
  parent    Parent?
  children  Child[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Admin model extending User
model Admin {
  id   String @id
  user User   @relation(fields: [id], references: [id])
}

// Assistant model extending User
model Assistant {
  id   String @id
  user User   @relation(fields: [id], references: [id])
}

// Parent model extending User
model Parent {
  id           String       @id
  relationship Relationship
  user         User         @relation(fields: [id], references: [id])
  children     Child[] // Changed to many-to-many
}

model Child {
  id               String   @id @default(uuid())
  name             String
  dob              DateTime
  healthInfo       String?
  allergies        String?
  medications      String?
  emergencyContact String?
  specialNeeds     String?

  // Change to many-to-many relationship
  parents   Parent[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  User      User?    @relation(fields: [userId], references: [id])
  userId    String?
}

enum Role {
  ADMIN
  ASSISTANT
  PARENT
}

enum Relationship {
  MOTHER
  FATHER
  GUARDIAN
}
